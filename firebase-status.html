<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Status - MediMatch</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 1200px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2563eb;
            margin-bottom: 10px;
        }
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        .status-card {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
        }
        .status-card.loaded {
            border-color: #10b981;
            background: #d1fae5;
        }
        .status-card.empty {
            border-color: #f59e0b;
            background: #fef3c7;
        }
        .status-card.error {
            border-color: #ef4444;
            background: #fee2e2;
        }
        .status-card h3 {
            margin: 0 0 10px 0;
            font-size: 16px;
        }
        .count {
            font-size: 32px;
            font-weight: bold;
            margin: 10px 0;
        }
        .count.good { color: #10b981; }
        .count.warn { color: #f59e0b; }
        .count.bad { color: #ef4444; }
        button {
            background: #2563eb;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            background: #1d4ed8;
        }
        button.secondary {
            background: #64748b;
        }
        button.secondary:hover {
            background: #475569;
        }
        button.danger {
            background: #ef4444;
        }
        button.danger:hover {
            background: #dc2626;
        }
        #log {
            background: #1e293b;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            margin-top: 20px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        .log-success { color: #10b981; }
        .log-error { color: #ef4444; }
        .log-warn { color: #f59e0b; }
        .log-info { color: #3b82f6; }
        .actions {
            margin: 20px 0;
            padding: 20px;
            background: #f1f5f9;
            border-radius: 6px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        th, td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
            font-size: 13px;
        }
        th {
            background: #f1f5f9;
            font-weight: 600;
        }
        .badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
        }
        .badge.tier1 { background: #fee2e2; color: #991b1b; }
        .badge.tier2 { background: #fef3c7; color: #92400e; }
        .badge.tier3 { background: #dbeafe; color: #1e40af; }
        .badge.tier4 { background: #e2e8f0; color: #475569; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üî• Firebase Status Dashboard</h1>
        <p style="color: #666; margin-bottom: 30px;">Check what's in your Firestore database</p>

        <div class="status-grid">
            <div class="status-card" id="patients-card">
                <h3>üë• Patients</h3>
                <div class="count" id="patients-count">-</div>
                <p id="patients-status">Checking...</p>
            </div>

            <div class="status-card" id="doctors-card">
                <h3>ü©∫ Doctors</h3>
                <div class="count" id="doctors-count">-</div>
                <p id="doctors-status">Checking...</p>
            </div>

            <div class="status-card" id="appointments-card">
                <h3>üìÖ Appointments</h3>
                <div class="count" id="appointments-count">-</div>
                <p id="appointments-status">Checking...</p>
            </div>

            <div class="status-card" id="matches-card">
                <h3>ü§ù Matches</h3>
                <div class="count" id="matches-count">-</div>
                <p id="matches-status">Checking...</p>
            </div>
        </div>

        <div class="actions">
            <h3>üõ†Ô∏è Actions</h3>
            <button onclick="checkStatus()">üîÑ Refresh Status</button>
            <button onclick="window.location.href='/seed-demo-data.html'" class="secondary">
                üå± Seed Demo Data
            </button>
            <button onclick="window.location.href='/matching'" class="secondary">
                üîç Go to Matching Page
            </button>
            <button onclick="showPatientDetails()" class="secondary">
                üë• Show Patient Details
            </button>
        </div>

        <div id="details" style="display: none; margin-top: 20px;">
            <h3>Patient Details</h3>
            <div id="patient-list"></div>
        </div>

        <div id="log"></div>
    </div>

    <script type="module">
        import { collection, getDocs, query, where } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        import { db } from './src/firebase/config.js';

        let logEl;

        window.addEventListener('DOMContentLoaded', () => {
            logEl = document.getElementById('log');
            log('üöÄ Firebase Status Dashboard loaded', 'info');
            checkStatus();
        });

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const className = `log-${type}`;
            logEl.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
            logEl.scrollTop = logEl.scrollHeight;
        }

        async function checkStatus() {
            log('üîç Checking Firestore status...', 'info');

            try {
                // Check patients
                const patientsQ = query(collection(db, 'users'), where('role', '==', 'patient'));
                const patientsSnapshot = await getDocs(patientsQ);
                const patientCount = patientsSnapshot.size;

                updateCard('patients', patientCount, patientCount > 0 ? 'loaded' : 'empty');
                log(`‚úÖ Patients: ${patientCount}`, patientCount > 0 ? 'success' : 'warn');

                // Store for details
                window.patientsData = patientsSnapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));

                // Check doctors
                const doctorsQ = query(collection(db, 'users'), where('role', '==', 'doctor'));
                const doctorsSnapshot = await getDocs(doctorsQ);
                const doctorCount = doctorsSnapshot.size;

                updateCard('doctors', doctorCount, doctorCount > 0 ? 'loaded' : 'empty');
                log(`‚úÖ Doctors: ${doctorCount}`, doctorCount > 0 ? 'success' : 'warn');

                // Check appointments
                const appointmentsSnapshot = await getDocs(collection(db, 'appointments'));
                const appointmentCount = appointmentsSnapshot.size;

                updateCard('appointments', appointmentCount, appointmentCount > 0 ? 'loaded' : 'empty');
                log(`‚úÖ Appointments: ${appointmentCount}`, appointmentCount > 0 ? 'success' : 'warn');

                // Check matches
                const matchesSnapshot = await getDocs(collection(db, 'matches'));
                const matchCount = matchesSnapshot.size;

                updateCard('matches', matchCount, matchCount >= 0 ? 'loaded' : 'empty');
                log(`‚úÖ Matches: ${matchCount}`, 'success');

                log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ', 'info');

                if (patientCount === 0 || doctorCount === 0 || appointmentCount === 0) {
                    log('‚ö†Ô∏è Some collections are empty! Click "Seed Demo Data" to populate.', 'warn');
                } else {
                    log('‚úÖ All collections have data!', 'success');
                }

            } catch (error) {
                log(`‚ùå Error: ${error.message}`, 'error');
                console.error('Error checking status:', error);
            }
        }

        function updateCard(name, count, status) {
            const card = document.getElementById(`${name}-card`);
            const countEl = document.getElementById(`${name}-count`);
            const statusEl = document.getElementById(`${name}-status`);

            card.className = `status-card ${status}`;
            countEl.textContent = count;
            countEl.className = count > 0 ? 'count good' : 'count warn';

            if (status === 'loaded') {
                statusEl.textContent = count === 1 ? '1 record' : `${count} records`;
            } else if (status === 'empty') {
                statusEl.textContent = 'No data - seed required';
            } else {
                statusEl.textContent = 'Error loading';
            }
        }

        window.checkStatus = checkStatus;

        window.showPatientDetails = function() {
            const detailsDiv = document.getElementById('details');
            const listDiv = document.getElementById('patient-list');

            if (!window.patientsData || window.patientsData.length === 0) {
                alert('No patients found. Run checkStatus() first or seed data.');
                return;
            }

            let html = '<table><thead><tr>' +
                '<th>ID</th><th>Name</th><th>Specialty</th><th>Urgency</th>' +
                '<th>Wait Days</th><th>Insurance</th><th>Transport</th>' +
                '</tr></thead><tbody>';

            window.patientsData.forEach(p => {
                html += `<tr>
                    <td>${p.id}</td>
                    <td>${p.fullName || 'N/A'}</td>
                    <td>${p.specialty || 'N/A'}</td>
                    <td>${p.urgencyLevel || p.aiUrgencyScore || 'N/A'}/10</td>
                    <td>${p.waitTimeDays || 0}</td>
                    <td>${p.insurance || 'N/A'}</td>
                    <td>${p.transportation || 'N/A'}</td>
                </tr>`;
            });

            html += '</tbody></table>';
            listDiv.innerHTML = html;
            detailsDiv.style.display = 'block';

            log('üìä Patient details displayed', 'info');
        };
    </script>
</body>
</html>
